# 안정 해시 설계

N개의 캐시 서버가 있을 때 보통 `serverIndex = 해시값 % N `과 같은 간단한 방법으로 부하를 균등하게 나누려고 한다.

그러나 서버가 추가/삭제 될 경우 이 방법은 문제가 생겨, 해시를 재분배할 경우 대부분의 해시가 엉뚱한 서버에 들어있게 되는 문제가 생긴다.

## 안정 해시

### 해시 링

테이블 크기가 조절되어도 오직 `k/n`개의 해시 (k는 키 갯수, n은 슬롯 갯수) 만 재배치하게 하는 해시 기술.

해시값의 범위를 해시 공간이라고 했을 때 처음과 끝을 이어지게 구부리면 `해시 링`이 완성된다.

먼저 서버의 가상 위치를 해시 링 위에 위치시키고, 캐시할 키를 해시 링 위의 어느 지점에 위치시켰을 때, 서버를 추가하거나 삭제하더라도 키의 위치에서 시계방형으로 가장 먼저 만나는 위치의 서버에 다시 저장하면 된다.

하지만 이 방식은 서버 간의 간격(파티션)을 균등하게 유지하기 어렵다는 단점이 있다. 

### 가상 노드 

가상 노드 방식은 하나의 서버가 링 위에 여러개의 가상 노드를 가지는 방법론이다. 이를 통해 표준 편차를 줄일 수 있다.