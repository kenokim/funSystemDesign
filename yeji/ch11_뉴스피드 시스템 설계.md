뉴스피드 : 홈페이지 중앙에 지속적으로 업데이트 되는 스토리들. 사용자 정보 업데이트. 사진 비디오 링크 앱활동 팔로우 등등

지원 기기 ( 웹/모바일) 스토리 순서(최신, 점수)천만DAU

- 피드 발행(포스팅) : 해당 데이터를 캐시와 데이터베이스에 기록. 새 포스팅은 친구의 뉴스피드에 전송
    - 로드밸런서 : 트래픽을 웹서버들로 분산
    - 웹서버 : 클라이언트와 통신, 이증 , 처리율 제한, 사용자
    - 포스팅 저장 서비스 : 새 포스팅을 디비와 캐시에 저장
    - 포스팅 전송 서비스 : 새 포스팅을 친구의 뉴스피드에 푸시(캐시)
        - 쓰기 팬아웃(푸시모델) - 뉴스피드가 실시간 갱신 가능, 뉴스피드 읽기 시 시간 감소/ 핫키 문제(친구가 많은경우 목록조회 ,피드 갱신 시 많은시간 소요) , 자주 사용하지 않는 사용자의 피드까지 갱신
        - 읽기 팬아웃 (풀 모델) - 비화성화 사용자 고려, 핫키X / 뉴스피드 읽는데 많은 시간 소요
        - 친구 수(그래프 데이터베이스)를기준으로 적은 사람은 푸시, 많은사람은 풀
        - 안정 해시를 통해 요청과 데이터를 고르게 분산하여 핫키 문제 줄이기
        - 상세
            1. 그래프 데이터베이스에서 친구 id 목록 가져오기
            2. 사용자 정보 캐시에서 뮤트,공개범위 등의 설정 가져오기
            3. 친구 목록과 새 스토리의 id를 메시지 큐에 넣음
            4. 팬아웃 작업 서버가 큐에서 데이터를 꺼내 데이터를 뉴스피드 캐시에 넣음. <포스팅id,사용자id>id만 보관하여 데이터 양 줄임. 최신 스토리를 보고자 함으로 캐시 미스의 확률은 낮음
      
    - 알림 서비스 : 새게시글 알림
- 뉴스피드 생성(피드읽기) : 모든 친구의 포스팅을 시간흐름 역순
    - 로드밸런서 : 트래픽을 웹서버들로 분산
    - 뉴스피드 서비스 : 캐시에서 뉴스피드 읽음
    - 상세
        - 이미지나 비디오 같은 미디어는 cdn에 저장
        1. 사용자 요청 → 로드밸런서 → 웹서버주 ㅇ하나 → 피드 서비스 호출
        2. 뉴스피드 서비스는 캐시에서 포스팅 id 목록을 가져와서 필요한 데이터로 뉴스피드 생성
        3. 클라이언트에게 전송
          
    - 뉴스피드 캐시 : 뉴스피드를 렌더링할때 필요한 피드 id
    - 캐시 상세
        - 뉴스피드id, 인기 콘텐츠 데이터, 사용자관 관계정보,

  

기타

- 데이터베이스 규모 확장
    - 수직/수평 , sql vs nosql, 마스터슬레이브, 복제본 읽기 연산, 일관성 모델, 샤딩
- 웹계층 무상태
- 데이터캐시 지원
- 여러 데이터 센터
- 메시지 큐를 사용한 컴포넌트 사이의 결합도 감소
- 핵심 메트릭 모니터링(시간대, 새로고침 지연시간)

최신순이아니라 점수를 기준으로 하면?

최근 접속 시간도 요소가 될수 있을지/ 쌍방 팔로우 여부(인기인의 경우)

좋아요 같은 경우는 매번 디비를 바꾸기도, 로그를 쌓고 합산하기도 쉽지않을것같음 뭐가 좋을지?
